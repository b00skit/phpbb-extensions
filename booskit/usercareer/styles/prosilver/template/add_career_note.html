{% INCLUDE 'overall_header.html' %}

<a href="{{ U_BACK }}" class="arrow-{{ S_CONTENT_FLOW_BEGIN }}">{{ lang('BACK') }}</a>

<script>
	var form_name = 'postform';
	var text_name = 'description';
</script>

<form id="postform" method="post" action="{{ U_ACTION }}">

    {% if BOOSKIT_CAREER_RULESET %}
    <div class="rules">
        <div class="inner">
            <div class="content">{{ BOOSKIT_CAREER_RULESET|raw }}</div>
        </div>
    </div>
    {% endif %}

<div class="panel">
	<div class="inner">
		<h3>{{ PAGE_TITLE }}</h3>

		<fieldset>
			<dl>
				<dt><label for="career_type_id">{{ lang('CAREER_TYPE') }}</label></dt>
				<dd>
					<select name="career_type_id" id="career_type_id">
						{% for type in types %}
						<option value="{{ type.ID }}"{% if type.SELECTED %} selected="selected"{% endif %}>{{ type.NAME }}</option>
						{% endfor %}
					</select>
				</dd>
			</dl>
			<dl>
				<dt><label for="note_date">{{ lang('CAREER_DATE') }}</label></dt>
				<dd><input type="date" name="note_date" id="note_date" value="{{ S_NOTE_DATE }}" class="inputbox" /></dd>
			</dl>

			<dl>
				<dt><label for="description">{{ lang('CAREER_DESCRIPTION') }}</label></dt>
				<dd><textarea name="description" id="description" rows="10" cols="45" class="inputbox" tabindex="3">{{ DESCRIPTION }}</textarea></dd>
			</dl>
		</fieldset>
	</div>
</div>

<div class="panel" id="public_post_settings" style="display: none;">
	<div class="inner">
		<h3>{{ lang('PUBLIC_POST_SETTINGS') }}</h3>
		<fieldset>
			<dl>
				<dt><label for="make_public_post">{{ lang('MAKE_PUBLIC_POST') }}</label></dt>
				<dd><input type="checkbox" name="make_public_post" id="make_public_post" value="1" /></dd>
			</dl>
			<div id="custom_fields_container" style="display: none;">
				<!-- Dynamic fields injected here -->
			</div>
		</fieldset>
	</div>
</div>

<div class="panel">
	<div class="inner">
		<fieldset class="submit-buttons">
			{{ S_FORM_TOKEN }}
			<input type="submit" accesskey="s" tabindex="6" name="submit" value="{{ lang('SUBMIT') }}" class="button1" />&nbsp;
		</fieldset>
	</div>
</div>

</form>

<script>
(function() {
	var definitions = {{ DEFINITIONS_JSON|raw }};
	var typeSelect = document.getElementById('career_type_id');
	var settingsPanel = document.getElementById('public_post_settings');
	var makePublicCheckbox = document.getElementById('make_public_post');
	var fieldsContainer = document.getElementById('custom_fields_container');

	function getDefinition(id) {
		for (var i = 0; i < definitions.length; i++) {
			if (definitions[i].id == id) {
				return definitions[i];
			}
		}
		return null;
	}

	function updateVisibility() {
		var selectedId = typeSelect.value;
		var def = getDefinition(selectedId);

		if (def && def.enable_public_posting) {
			settingsPanel.style.display = 'block';
			updateFields(def);
		} else {
			settingsPanel.style.display = 'none';
			makePublicCheckbox.checked = false;
			fieldsContainer.style.display = 'none';
		}
	}

	function updateFields(def) {
		var fields = [];
		try {
			if (def.public_posting_fields) {
				fields = JSON.parse(def.public_posting_fields);
			}
		} catch (e) { }

		fieldsContainer.innerHTML = '';

		if (fields.length > 0) {
			fields.forEach(function(field) {
				var dl = document.createElement('dl');
				var dt = document.createElement('dt');
				var label = document.createElement('label');
				label.textContent = field.name;
				dt.appendChild(label);
				if (field.description) {
					var br = document.createElement('br');
					var span = document.createElement('span');
					span.textContent = field.description;
					dt.appendChild(br);
					dt.appendChild(span);
				}

				var dd = document.createElement('dd');
				var input;

				if (field.type === 'textarea') {
					input = document.createElement('textarea');
					input.name = 'custom_fields[' + field.variable + ']';
					input.className = 'inputbox';
					input.rows = 5;
					if (field.placeholder) input.placeholder = field.placeholder;
				} else {
					input = document.createElement('input');
					input.type = 'text';
					input.name = 'custom_fields[' + field.variable + ']';
					input.className = 'inputbox';
					if (field.placeholder) input.placeholder = field.placeholder;
				}

				dd.appendChild(input);
				dl.appendChild(dt);
				dl.appendChild(dd);
				fieldsContainer.appendChild(dl);
			});
		}
	}

	typeSelect.addEventListener('change', updateVisibility);

	makePublicCheckbox.addEventListener('change', function() {
		if (this.checked) {
			fieldsContainer.style.display = 'block';
		} else {
			fieldsContainer.style.display = 'none';
		}
	});

	// Initial state
	updateVisibility();
	if (makePublicCheckbox.checked) {
		fieldsContainer.style.display = 'block';
	}
})();
</script>

{% INCLUDE 'overall_footer.html' %}
